<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>German Trainer</title>
  <style>
    :root{
      --black:#0b0b0f;
      --dark:#1a0b0b;
      --red:#ff0b0b;
      --dark-red:#3a0606;
      --red-light:#ff3d3d;
      --muted:#bf9a9a;
      --card:#200f0f;
    }
    *{box-sizing:border-box;font-family: 'Segoe UI', Tahoma, Arial, sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--black),var(--dark-red));color:var(--muted)}
    .app{max-width:1100px;margin:24px auto;padding:18px;}
    .hidden{display:none !important;}

    /* Navigation */
    .nav-bar{display:flex;gap:12px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid rgba(255,11,11,0.2)}
    .nav-btn{background:transparent;color:#ff9a9a;padding:8px 16px;border-radius:8px;border:1px solid rgba(255,11,11,0.3);cursor:pointer;font-weight:600;transition:all 0.3s}
    .nav-btn:hover{background:rgba(255,11,11,0.1);color:#ffcccc}
    .nav-btn.active{background:var(--red);color:white;border-color:var(--red)}
    
    /* Pages */
    .page{display:none;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:20px;box-shadow:0 6px 18px rgba(23,2,2,0.6);border:1px solid rgba(255,11,11,0.12)}
    .page.active{display:block;animation:fadeIn 0.5s}
    
    /* Editor page */
    .editor-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media(max-width:768px){.editor-grid{grid-template-columns:1fr}}
    
    .input-group{margin-bottom:15px}
    h1{color:#ffe6e6;margin:0 0 15px 0;font-size:24px;border-bottom:2px solid rgba(255,11,11,0.3);padding-bottom:8px}
    h2{color:#ffcccc;margin:15px 0 10px 0;font-size:18px}
    label{display:block;margin:8px 0 6px;color:var(--muted);font-size:14px}
    input[type=text], input[type=number]{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.3);color:#ffe6e6;font-size:15px}
    input[type=text]:focus, input[type=number]:focus{outline:none;border-color:var(--red-light);box-shadow:0 0 0 2px rgba(255,61,61,0.2)}
    
    .button-group{display:flex;flex-wrap:wrap;gap:8px;margin:15px 0}
    button{background:var(--red);color:white;padding:10px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:all 0.2s;font-size:14px}
    button:hover{background:var(--red-light);transform:translateY(-1px)}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.1);color:#ffcccc}
    button.ghost:hover{background:rgba(255,255,255,0.05);border-color:var(--red-light)}
    button.small{font-size:13px;padding:8px 12px}
    
    /* Word list */
    .list-container{margin-top:20px;border:1px solid rgba(255,11,11,0.1);border-radius:8px;overflow:hidden}
    .list-header{background:rgba(255,11,11,0.1);padding:12px;display:flex;justify-content:space-between;color:#ffcccc;font-weight:600}
    .word-list{height:400px;overflow:auto;background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.2))}
    @media(max-width:768px){.word-list{height:300px}}
    
    .word-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid rgba(255,255,255,0.03);transition:background 0.2s}
    .word-item:hover{background:rgba(255,11,11,0.05)}
    .word-content{flex-grow:1}
    .word-text{font-size:16px;color:#ffebeb;font-weight:500}
    .word-meaning{font-size:13px;color:var(--muted);margin-top:4px}
    .word-actions{display:flex;gap:6px;flex-shrink:0}
    
    /* Quiz page */
    .quiz-container{max-width:600px;margin:0 auto}
    .quiz-header{text-align:center;margin-bottom:25px}
    .quiz-stats{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:15px;background:rgba(255,11,11,0.08);border-radius:10px;border:1px solid rgba(255,11,11,0.2)}
    .stat-box{text-align:center}
    .stat-value{font-size:28px;color:#ffebeb;font-weight:bold}
    .stat-label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
    
    .quiz-question{background:linear-gradient(90deg, rgba(255,11,11,0.15), rgba(58,6,6,0.15));padding:20px;border-radius:12px;margin-bottom:25px;color:#ffebeb;font-size:20px;text-align:center;min-height:120px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,11,11,0.2)}
    
    .quiz-options{display:grid;gap:12px;margin-bottom:20px}
    .quiz-option{padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);background:rgba(0,0,0,0.3);cursor:pointer;text-align:center;font-size:16px;color:#ffebeb;transition:all 0.2s}
    .quiz-option:hover{background:rgba(255,11,11,0.1);border-color:var(--red-light)}
    .quiz-option.correct{background:rgba(25,181,107,0.2);border-color:#19b56b;color:#d1ffe9}
    .quiz-option.wrong{background:rgba(255,77,77,0.2);border-color:#ff4d4d;color:#ffd1d1}
    
    .quiz-controls{display:flex;gap:10px;justify-content:center;margin-top:25px}
    
    /* Mistakes review */
    .mistakes-section{margin-top:30px;padding-top:20px;border-top:1px solid rgba(255,11,11,0.2)}
    .mistakes-title{color:#ff4d4d;font-size:18px;margin-bottom:15px;display:flex;align-items:center;gap:8px}
    .mistakes-title:before{content:"âš ï¸"}
    
    .mistake-item{margin:12px 0;padding:12px;background:rgba(255,77,77,0.08);border-radius:8px;border-left:3px solid #ff4d4d}
    .mistake-question{color:#ffcccc;font-weight:500;margin-bottom:6px}
    .mistake-answer{display:flex;justify-content:space-between;margin-top:6px;font-size:14px}
    .correct-answer{color:#19b56b}
    .wrong-answer{color:#ff4d4d}
    
    /* Settings */
    .settings-group{margin:20px 0}
    .setting-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(0,0,0,0.2);border-radius:8px;margin:10px 0}
    
    /* Animations */
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    
    footer{text-align:center;margin-top:20px;color:rgba(255,255,255,0.2);font-size:12px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.05)}
  </style>
</head>
<body>
  <div class="app">
    <!-- Navigation -->
    <div class="nav-bar">
      <button class="nav-btn active" data-page="editor">âœï¸ Ù…Ø­Ø±Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
      <button class="nav-btn" data-page="quiz">ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø±</button>
      <button class="nav-btn" data-page="settings">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>

    <!-- Editor Page -->
    <div class="page active" id="editor-page">
      <div class="editor-grid">
        <div>
          <h1>Ø£Ø¶Ù ÙƒÙ„Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h1>
          <div class="input-group">
            <label>Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</label>
            <input id="german" type="text" placeholder="Ù…Ø«Ø§Ù„: Apfel" />
          </div>
          <div class="input-group">
            <label>Ø§Ù„Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</label>
            <input id="english" type="text" placeholder="Ù…Ø«Ø§Ù„: Apple" />
          </div>
          
          <div class="button-group">
            <button id="add">â• Ø£Ø¶Ù</button>
            <button id="pron" class="ghost">ğŸ”Š Ù†Ø·Ù‚</button>
            <button id="clear-inputs" class="ghost">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
          </div>
          
          <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
          <div class="button-group">
            <button id="save" class="ghost">ğŸ’¾ Ø­ÙØ¸ JSON</button>
            <button id="load" class="ghost">ğŸ“‚ ØªØ­Ù…ÙŠÙ„ JSON</button>
            <button id="csv" class="ghost">ğŸ“Š ØªØµØ¯ÙŠØ± CSV</button>
          </div>
        </div>
        
        <div>
          <h1>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª (<span id="wordCount">0</span>)</h1>
          <div class="list-container">
            <div class="list-header">
              <span>ÙƒÙ„Ù…Ø© Ø£Ù„Ù…Ø§Ù†ÙŠØ©</span>
              <span>Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</span>
            </div>
            <div class="word-list" id="wordList"></div>
          </div>
          
          <div class="button-group" style="margin-top:15px">
            <button id="clear-all" class="ghost" style="background:rgba(255,77,77,0.2);color:#ff9999">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
            <button id="shuffle-words" class="ghost">ğŸ”€ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quiz Page -->
    <div class="page" id="quiz-page">
      <div class="quiz-container">
        <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</h1>
        
        <div class="quiz-stats">
          <div class="stat-box">
            <div class="stat-value" id="score">0/0</div>
            <div class="stat-label">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="remaining">0</div>
            <div class="stat-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="accuracy">0%</div>
            <div class="stat-label">Ø§Ù„Ø¯Ù‚Ø©</div>
          </div>
        </div>
        
        <div class="quiz-question" id="prompt">
          Ø£Ø¶Ù ÙƒÙ„Ù…Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"
        </div>
        
        <div class="quiz-options" id="opts"></div>
        
        <div class="quiz-controls">
          <button id="start-quiz" style="background:linear-gradient(135deg, var(--red), #ff3d3d);padding:12px 30px;font-size:16px">â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
          <button id="next-question" class="ghost" style="display:none">â­ï¸ Ø§Ù„ØªØ§Ù„ÙŠ</button>
          <button id="end-quiz" class="ghost" style="display:none">â¹ï¸ Ø¥Ù†Ù‡Ø§Ø¡</button>
        </div>
        
        <div id="mistakes-container" style="display:none">
          <div class="mistakes-section">
            <h2 class="mistakes-title">Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (<span id="mistakes-count">0</span>)</h2>
            <div id="mistakes-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Page -->
    <div class="page" id="settings-page">
      <h1>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
      
      <div class="settings-group">
        <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
        <div class="setting-item">
          <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„:</span>
          <select id="optionsCount" style="background:rgba(0,0,0,0.3);color:#ffebeb;border:1px solid rgba(255,255,255,0.1);padding:6px 10px;border-radius:6px">
            <option value="2">2 Ø®ÙŠØ§Ø±Ø§Øª</option>
            <option value="3">3 Ø®ÙŠØ§Ø±Ø§Øª</option>
            <option value="4" selected>4 Ø®ÙŠØ§Ø±Ø§Øª</option>
            <option value="5">5 Ø®ÙŠØ§Ø±Ø§Øª</option>
            <option value="6">6 Ø®ÙŠØ§Ø±Ø§Øª</option>
          </select>
        </div>
        
        <div class="setting-item">
          <span>Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</span>
          <label style="cursor:pointer">
            <input type="checkbox" id="usePron" checked />
            <span style="margin-left:8px">ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø·Ù‚ Ø¹Ù†Ø¯ ÙƒÙ„ Ø³Ø¤Ø§Ù„</span>
          </label>
        </div>
        
        <div class="setting-item">
          <span>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</span>
          <input type="number" id="quizLimit" min="5" max="100" value="30" style="width:80px;text-align:center" />
        </div>
      </div>
      
      <div class="settings-group">
        <h2>Ø§Ù„Ù…Ø¸Ù‡Ø±</h2>
        <div class="setting-item">
          <span>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</span>
          <input type="color" id="themeColor" value="#ff0b0b" style="width:40px;height:30px;border:none;background:none;cursor:pointer" />
        </div>
      </div>
      
      <div class="button-group" style="margin-top:30px">
        <button id="reset-settings" class="ghost">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¶Ø¨Ø·</button>
        <button id="export-data" class="ghost">ğŸ“¦ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
      </div>
    </div>

    <footer>German Trainer â€” Ù…Ù„Ù HTML ÙˆØ§Ø­Ø¯ ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ | ÙŠØ¯Ø¹Ù… Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±</footer>
  </div>

  <!-- Hidden file input -->
  <input id="fileInput" type="file" accept="application/json" style="display:none" />

  <script>
    // Data & storage
    const WORDS_KEY = 'german_trainer_words_v2';
    const SETTINGS_KEY = 'german_trainer_settings';
    let words = JSON.parse(localStorage.getItem(WORDS_KEY) || '[]');
    let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{"optionsCount":4,"usePron":true,"quizLimit":30,"themeColor":"#ff0b0b"}');
    let quizQueue = [];
    let current = null;
    let correct = 0, attempts = 0;
    let mistakes = [];
    let quizActive = false;

    // UI refs
    const germanInput = document.getElementById('german');
    const englishInput = document.getElementById('english');
    const addBtn = document.getElementById('add');
    const pronBtn = document.getElementById('pron');
    const listEl = document.getElementById('wordList');
    const wordCountEl = document.getElementById('wordCount');
    const saveBtn = document.getElementById('save');
    const loadBtn = document.getElementById('load');
    const csvBtn = document.getElementById('csv');
    const clearAllBtn = document.getElementById('clear-all');
    const clearInputsBtn = document.getElementById('clear-inputs');
    const shuffleWordsBtn = document.getElementById('shuffle-words');
    
    // Quiz elements
    const startQuizBtn = document.getElementById('start-quiz');
    const nextQuizBtn = document.getElementById('next-question');
    const endQuizBtn = document.getElementById('end-quiz');
    const optsCount = document.getElementById('optionsCount');
    const quizLimit = document.getElementById('quizLimit');
    const themeColor = document.getElementById('themeColor');
    const optsEl = document.getElementById('opts');
    const promptEl = document.getElementById('prompt');
    const scoreEl = document.getElementById('score');
    const remainingEl = document.getElementById('remaining');
    const accuracyEl = document.getElementById('accuracy');
    const mistakesContainer = document.getElementById('mistakes-container');
    const mistakesList = document.getElementById('mistakes-list');
    const mistakesCount = document.getElementById('mistakes-count');
    
    // Navigation
    const navBtns = document.querySelectorAll('.nav-btn');
    const pages = document.querySelectorAll('.page');
    
    // File input
    const fileInput = document.getElementById('fileInput');

    // Initialize settings
    function initSettings() {
      optsCount.value = settings.optionsCount || 4;
      document.getElementById('usePron').checked = settings.usePron !== false;
      quizLimit.value = settings.quizLimit || 30;
      themeColor.value = settings.themeColor || '#ff0b0b';
      updateTheme();
    }

    function updateTheme() {
      const root = document.documentElement;
      root.style.setProperty('--red', settings.themeColor);
      root.style.setProperty('--red-light', lightenColor(settings.themeColor, 30));
      root.style.setProperty('--dark-red', darkenColor(settings.themeColor, 40));
    }

    function lightenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (
        0x1000000 +
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)
      ).toString(16).slice(1);
    }

    function darkenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) - amt;
      const G = (num >> 8 & 0x00FF) - amt;
      const B = (num & 0x0000FF) - amt;
      return '#' + (
        0x1000000 +
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)
      ).toString(16).slice(1);
    }

    // Save settings
    function saveSettings() {
      settings.optionsCount = parseInt(optsCount.value);
      settings.usePron = document.getElementById('usePron').checked;
      settings.quizLimit = parseInt(quizLimit.value);
      settings.themeColor = themeColor.value;
      localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
      updateTheme();
    }

    // Navigation
    navBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const pageId = btn.dataset.page;
        
        // Update active nav button
        navBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Show selected page
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(`${pageId}-page`).classList.add('active');
        
        // If going to quiz page, update stats
        if (pageId === 'quiz') {
          updateQuizStats();
        }
      });
    });

    // Helpers
    function persist(){ localStorage.setItem(WORDS_KEY, JSON.stringify(words)); }
    
    function renderList(){
      listEl.innerHTML='';
      words.forEach((w,i)=>{
        const item = document.createElement('div');
        item.className='word-item';
        item.innerHTML = `
          <div class="word-content">
            <div class="word-text">${escapeHtml(w.german)}</div>
            <div class="word-meaning">${escapeHtml(w.english)}</div>
          </div>
          <div class="word-actions">
            <button class="small ghost" onclick="pronounce('${escapeHtml(w.german)}')" title="Ù†Ø·Ù‚">ğŸ”Š</button>
            <button class="small ghost" onclick="selectWord(${i})" title="ØªØ­Ø¯ÙŠØ¯">ğŸ“</button>
            <button class="small ghost" onclick="deleteWord(${i})" title="Ø­Ø°Ù" style="color:#ff9999">ğŸ—‘ï¸</button>
          </div>
        `;
        listEl.appendChild(item);
      });
      wordCountEl.textContent = words.length;
    }

    function escapeHtml(s){ 
      if (!s) return '';
      return s.toString().replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"
      })[c]); 
    }

    // Word functions
    window.selectWord = function(i){
      if (words[i]) {
        germanInput.value = words[i].german;
        englishInput.value = words[i].english;
      }
    };

    window.deleteWord = function(i){
      if(confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ')){
        words.splice(i,1);
        persist();
        renderList();
      }
    };

    // Add word
    addBtn.addEventListener('click', ()=>{
      const g = germanInput.value.trim();
      const e = englishInput.value.trim();
      if(!g || !e){ alert('ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚Ù„ÙŠÙ†'); return; }
      words.push({german:g, english:e}); 
      persist(); 
      renderList(); 
      germanInput.value=''; 
      englishInput.value='';
      germanInput.focus();
    });

    // Pronunciation
    pronBtn.addEventListener('click', ()=>{ 
      const text = germanInput.value.trim();
      if (text) pronounce(text); 
    });

    function pronounce(text){
      if(!text) return; 
      if('speechSynthesis' in window){ 
        const ut = new SpeechSynthesisUtterance(text);
        ut.lang = 'de-DE'; 
        ut.rate = 0.9;
        window.speechSynthesis.cancel(); 
        window.speechSynthesis.speak(ut);
      } else {
        alert('Ù…ÙŠØ²Ø© Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
      }
    }

    // Clear inputs
    clearInputsBtn.addEventListener('click', ()=>{
      germanInput.value = '';
      englishInput.value = '';
      germanInput.focus();
    });

    // Clear all words
    clearAllBtn.addEventListener('click', ()=>{
      if(words.length === 0) return;
      if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª (${words.length} ÙƒÙ„Ù…Ø©)?`)){
        words=[];
        persist();
        renderList();
      }
    });

    // Shuffle words
    shuffleWordsBtn.addEventListener('click', ()=>{
      words = shuffle([...words]);
      persist();
      renderList();
    });

    // Save/load
    saveBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(words, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'german_words.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    loadBtn.addEventListener('click', ()=> fileInput.click());
    
    fileInput.addEventListener('change', ()=>{
      const f = fileInput.files[0]; 
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        try{ 
          const data = JSON.parse(reader.result); 
          if(Array.isArray(data)){
            words = data.filter(item => item.german && item.english && 
                     typeof item.german === 'string' && 
                     typeof item.english === 'string');
            persist(); 
            renderList(); 
            alert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${words.length} ÙƒÙ„Ù…Ø©`);
          } else {
            alert('ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ù„Ù JSON Ù…ØµÙÙˆÙØ©');
          }
        } catch(e){ 
          alert('Ù…Ù„Ù JSON ØºÙŠØ± ØµØ§Ù„Ø­');
        }
        fileInput.value = '';
      };
      reader.readAsText(f);
    });

    csvBtn.addEventListener('click', ()=>{
      if(words.length === 0){
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
        return;
      }
      let out = 'german,english\n';
      words.forEach(w => { 
        out += `"${w.german.replace(/"/g,'""')}","${w.english.replace(/"/g,'""')}"\n`; 
      });
      const blob = new Blob([out], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'german_words.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Quiz functions
    function updateQuizStats() {
      remainingEl.textContent = quizQueue.length;
      const accuracy = attempts > 0 ? Math.round((correct / attempts) * 100) : 0;
      accuracyEl.textContent = `${accuracy}%`;
      scoreEl.textContent = `${correct}/${attempts}`;
    }

    startQuizBtn.addEventListener('click', startQuiz);
    nextQuizBtn.addEventListener('click', nextQuestion);
    endQuizBtn.addEventListener('click', endQuiz);

    function startQuiz() {
      if(words.length < 2){ 
        alert('Ø£Ø¶Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙƒÙ„Ù…ØªÙŠÙ† Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        // Switch to editor page
        document.querySelector('[data-page="editor"]').click();
        return; 
      }
      
      quizActive = true;
      correct = 0; 
      attempts = 0; 
      mistakes = [];
      
      // Get quiz limit from settings
      const limit = parseInt(quizLimit.value) || 30;
      const quizWords = words.slice(-limit);
      
      if(quizWords.length < 2){
        alert(`ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ${2 - quizWords.length} ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±`);
        return;
      }
      
      quizQueue = shuffle([...quizWords]);
      
      // Update UI
      startQuizBtn.style.display = 'none';
      nextQuizBtn.style.display = 'inline-block';
      endQuizBtn.style.display = 'inline-block';
      mistakesContainer.style.display = 'none';
      
      nextQuestion();
    }

    function nextQuestion() {
      if(quizQueue.length === 0){ 
        endQuiz();
        return; 
      }
      
      current = quizQueue.pop();
      promptEl.innerHTML = `Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ù„Ù€:<br><strong style="color:#ffcccc;font-size:24px;margin-top:10px;display:block">${escapeHtml(current.english)}</strong>`;
      
      const numOpts = Math.max(2, Math.min(6, parseInt(optsCount.value) || 4));
      const limit = parseInt(quizLimit.value) || 30;
      const quizWords = words.slice(-limit);
      const choices = buildChoices(current.german, numOpts, quizWords);
      renderOptions(choices);
      
      if(document.getElementById('usePron').checked) {
        setTimeout(() => pronounce(current.german), 300);
      }
      
      updateQuizStats();
    }

    function buildChoices(correctGerman, num, wordPool){
      const pool = wordPool.map(w => w.german).filter(g => g !== correctGerman);
      const choices = [correctGerman];
      
      while(choices.length < num && pool.length){
        const i = Math.floor(Math.random() * pool.length); 
        choices.push(pool.splice(i,1)[0]);
      }
      
      while(choices.length < num) choices.push(correctGerman);
      return shuffle(choices);
    }

    function renderOptions(choices){
      optsEl.innerHTML='';
      choices.forEach(c => {
        const opt = document.createElement('div');
        opt.className = 'quiz-option';
        opt.textContent = c;
        opt.onclick = () => answer(c, opt);
        optsEl.appendChild(opt);
      });
    }

    function answer(choice, el){
      if(el.classList.contains('correct') || el.classList.contains('wrong')) return;
      
      attempts++; 
      const allOptions = document.querySelectorAll('.quiz-option');
      
      if(choice === current.german){
        correct++; 
        el.classList.add('correct');
        setTimeout(() => { 
          allOptions.forEach(opt => opt.style.pointerEvents = 'none');
          setTimeout(nextQuestion, 800);
        }, 300);
      } else { 
        el.classList.add('wrong');
        
        // Record mistake
        mistakes.push({
          question: current.english,
          correct: current.german,
          wrong: choice
        });
        
        // Highlight correct answer
        allOptions.forEach(opt => {
          if(opt.textContent === current.german) {
            opt.classList.add('correct');
          }
          opt.style.pointerEvents = 'none';
        });
        
        setTimeout(nextQuestion, 1200);
      } 
      
      updateQuizStats();
    }

    function endQuiz() {
      quizActive = false;
      
      promptEl.innerHTML = `
        <div style="text-align:center">
          <div style="font-size:48px">${correct === attempts ? 'ğŸ‰' : 'ğŸ“Š'}</div>
          <div style="font-size:24px;color:#ffcccc;margin:10px 0">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù†ØªÙ‡Ù‰!</div>
          <div style="font-size:18px;color:var(--muted)">${correct} Ù…Ù† ${attempts} Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©</div>
          <div style="font-size:16px;color:#19b56b;margin-top:10px">Ø§Ù„Ø¯Ù‚Ø©: ${attempts > 0 ? Math.round((correct / attempts) * 100) : 0}%</div>
        </div>
      `;
      
      optsEl.innerHTML = '';
      
      startQuizBtn.style.display = 'inline-block';
      nextQuizBtn.style.display = 'none';
      endQuizBtn.style.display = 'none';
      
      // Show mistakes if any
      if(mistakes.length > 0) {
        mistakesContainer.style.display = 'block';
        mistakesCount.textContent = mistakes.length;
        
        let mistakesHtml = '';
        mistakes.forEach((m, i) => {
          mistakesHtml += `
            <div class="mistake-item">
              <div class="mistake-question">${i+1}. ${escapeHtml(m.question)}</div>
              <div class="mistake-answer">
                <span class="correct-answer">âœ… ${escapeHtml(m.correct)}</span>
                <span class="wrong-answer">âŒ ${escapeHtml(m.wrong)}</span>
              </div>
            </div>
          `;
        });
        
        mistakesList.innerHTML = mistakesHtml;
      }
      
      updateQuizStats();
    }

    // Settings
    document.getElementById('usePron').addEventListener('change', saveSettings);
    optsCount.addEventListener('change', saveSettings);
    quizLimit.addEventListener('change', saveSettings);
    themeColor.addEventListener('change', saveSettings);

    document.getElementById('reset-settings').addEventListener('click', () => {
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ')){
        settings = {optionsCount:4, usePron:true, quizLimit:30, themeColor:'#ff0b0b'};
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        initSettings();
        alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
      }
    });

    document.getElementById('export-data').addEventListener('click', () => {
      const allData = {
        words: words,
        settings: settings,
        version: '2.0',
        exportDate: new Date().toISOString()
      };
      
      const data = JSON.stringify(allData, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'german_trainer_backup.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // Utils
    function shuffle(arr){ 
      const newArr = [...arr];
      for(let i = newArr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      // Ctrl+S to save
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
        e.preventDefault();
        saveBtn.click();
      }
      
      // Enter to add word (when in editor page and inputs focused)
      if(e.key === 'Enter' && document.activeElement === germanInput){
        addBtn.click();
      }
      
      // Space to pronounce (when german input focused)
      if(e.key === ' ' && document.activeElement === germanInput && germanInput.value.trim()){
        e.preventDefault();
        pronounce(germanInput.value.trim());
      }
    });

    // Initialize
    initSettings();
    renderList();
    updateQuizStats();
  </script>
</body>
</html>